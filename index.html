<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FIGHT AGAINST UNIVERSITIES</title>
  <style>
    :root {
      --bg: #0a0a1a;
      --ground: #1a1a2e;
      --sky: #0f3460;
      --hp-red: #ff4757;
      --hp-green: #2ed573;
      --special: #ffa502;
      --p1-color: #ff2e63;
      --p2-color: #08f7fe;
      --glow: #00ffff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #000;
      font-family: 'Courier New', monospace;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
    }
    #game {
      position: relative;
      width: 1200px;
      height: 600px;
      background: linear-gradient(to bottom, var(--sky) 0%, #16213e 40%, var(--ground) 100%);
      border: 8px solid #333;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 60px rgba(8, 247, 254, 0.6);
      cursor: crosshair;
    }
    #bg {
      position: absolute;
      width: 200%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(8,247,254,0.2) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,46,99,0.2) 0%, transparent 50%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect width="120" height="120" fill="%2316213e"/><circle cx="30" cy="40" r="10" fill="%2308f7fe" opacity="0.2"/><circle cx="90" cy="30" r="8" fill="%23ff2e63" opacity="0.2"/><path d="M0 90 Q 30 85, 60 90 T 120 90 L 120 120 L 0 120 Z" fill="%231a1a2e"/></svg>') repeat;
      animation: scroll 30s linear infinite;
    }
    @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    /* ÉCRAN D'ACCUEIL */
    #splash {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 300;
      backdrop-filter: blur(10px);
    }
    #splash h1 {
      font-size: 4.5rem;
      font-weight: bold;
      background: linear-gradient(90deg, #ff2e63, #08f7fe, #ffd60a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px rgba(255,255,255,0.6);
      margin-bottom: 40px;
      letter-spacing: 4px;
    }
    .splash-characters {
      display: flex;
      gap: 60px;
      margin-bottom: 50px;
    }
    .splash-char {
      width: 180px;
      height: 240px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: 4px solid transparent;
      border-radius: 20px;
      transition: 0.4s;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }
    .splash-char:hover {
      transform: scale(1.15);
      border-color: var(--glow);
      box-shadow: 0 0 50px rgba(0,255,255,0.7);
    }
    #startSplashBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 14px 40px;
      font-size: 1.6rem;
      background: linear-gradient(45deg, #ff2e63, #08f7fe);
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
      transition: 0.3s;
      z-index: 310;
    }
    #startSplashBtn:hover { transform: scale(1.1); }

    /* SÉLECTEUR */
    #selector {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 200;
      backdrop-filter: blur(10px);
    }
    .mode-container {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .mode-btn {
      padding: 14px 30px;
      background: #222;
      border: 2px solid #444;
      border-radius: 12px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    .mode-btn.selected {
      background: linear-gradient(45deg, #ff2e63, #08f7fe);
      border-color: transparent;
      box-shadow: 0 0 20px rgba(8,247,254,0.6);
    }
    .char-grid {
      display: flex;
      gap: 30px;
      margin: 20px 0;
    }
    .char-thumb {
      width: 120px;
      height: 160px;
      background: #111;
      border: 4px solid transparent;
      border-radius: 16px;
      cursor: pointer;
      transition: 0.3s;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    .char-thumb:hover, .char-thumb.selected {
      border-color: var(--glow);
      box-shadow: 0 0 30px rgba(0,255,255,0.6);
      transform: scale(1.1);
    }

    /* TITRE (disparaît au combat) */
    #title {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.8rem;
      font-weight: bold;
      background: linear-gradient(90deg, #ff2e63, #08f7fe, #ffd60a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(255,255,255,0.5);
      z-index: 11;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    #title.visible { opacity: 1; }

    /* HUD */
    .hud {
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      z-index: 10;
      pointer-events: none;
    }
    .player-hud {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(0,0,0,0.6);
      padding: 10px 16px;
      border-radius: 12px;
      border: 2px solid;
    }
    #p1-hud { border-color: var(--p1-color); }
    #p2-hud { border-color: var(--p2-color); flex-direction: row-reverse; }
    .name { font-weight: bold; font-size: 18px; }
    .hp-bar, .sp-bar {
      width: 200px; height: 20px; background: #111; border-radius: 10px; overflow: hidden; border: 1px solid #444;
    }
    .hp-fill { height: 100%; width: 100%; transition: width 0.2s ease; }
    #hp1 { background: var(--hp-green); }
    #hp2 { background: var(--hp-red); }
    .sp-fill { height: 100%; width: 0%; background: var(--special); transition: width 0.3s ease; }

    /* Personnages */
    .fighter {
      position: absolute;
      width: 140px;
      height: 200px;
      bottom: 80px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom;
      transition: none;
      z-index: 5;
      transform: scaleX(var(--dir, 1));
    }
    #p1 { left: 200px; --dir: 1; }
    #p2 { right: 200px; left: auto; --dir: -1; }
    .fighter.jumping { transform: translateY(-100px) scaleX(var(--dir)) scale(1.1); }
    .fighter.attacking { animation: punch 0.3s ease; }
    .fighter.blocking { filter: brightness(0.7) contrast(1.3); }
    .fighter.hurt { filter: brightness(2) hue-rotate(90deg); animation: hurt 0.2s; }

    @keyframes punch {
      0%, 100% { transform: translateX(0) scaleX(var(--dir)); }
      50% { transform: translateX(calc(50px * var(--dir))) scaleX(var(--dir)); }
    }
    @keyframes hurt {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-12px); }
      75% { transform: translateX(12px); }
    }

    /* Effets */
    .particle {
      position: absolute;
      width: 10px; height: 10px;
      background: #ff6b6b;
      border-radius: 50%;
      pointer-events: none;
      z-index: 4;
      animation: explode 0.6s ease-out forwards;
    }
    @keyframes explode {
      to { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
    }
    .screen-shake { animation: shake 0.4s ease; }
    @keyframes shake {
      0%,100% { transform: translate(0,0); }
      10%,30%,50%,70%,90% { transform: translate(var(--sx), var(--sy)); }
    }

    /* Victoire */
    #overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    #overlay h1 {
      font-size: 5.5rem;
      font-weight: bold;
      background: linear-gradient(90deg, #ff2e63, #08f7fe, #ffd60a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 40px rgba(255,255,255,0.6);
      margin-bottom: 40px;
    }
    #restartBtn {
      padding: 18px 50px;
      font-size: 1.6rem;
      background: linear-gradient(45deg, #ff2e63, #08f7fe);
      border: none;
      border-radius: 50px;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    #restartBtn:hover { transform: scale(1.1); }

    .controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.6);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      color: #ccc;
      z-index: 10;
    }

    #startGameBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 14px 40px;
      font-size: 1.4rem;
      background: linear-gradient(45deg, #ff2e63, #08f7fe);
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      z-index: 210;
    }

    @media (max-width: 1200px) {
      #game { width: 100vw; height: 80vh; border-radius: 0; border: none; }
      #splash h1 { font-size: 3rem; }
      .splash-characters { gap: 30px; }
      .splash-char { width: 140px; height: 190px; }
      #title { font-size: 2rem; top: 10px; }
      .hud { flex-direction: column; gap: 10px; top: 60px; left: 10px; right: 10px; }
      .hp-bar, .sp-bar { width: 140px; }
      .fighter { width: 110px; height: 160px; }
      .char-grid { flex-direction: column; }
      .mode-container { flex-direction: column; }
      #startSplashBtn, #startGameBtn { top: 10px; right: 10px; font-size: 1.3rem; padding: 10px 25px; }
    }
  </style>
</head>
<body>

<div id="game">
  <div id="bg"></div>

  <!-- ÉCRAN D'ACCUEIL -->
  <div id="splash">
    <h1>FIGHT AGAINST UNIVERSITIES</h1>
    <div class="splash-characters">
      <div class="splash-char" style="background-image:url('uemf.png')"></div>
      <div class="splash-char" style="background-image:url('um6p.png')"></div>
      <div class="splash-char" style="background-image:url('uir.png')"></div>
    </div>
    <button id="startSplashBtn">COMMENCER</button>
  </div>

  <!-- SÉLECTEUR -->
  <div id="selector">
    <div class="mode-container">
      <button class="mode-btn selected" data-mode="1p">1 PLAYER (vs AI)</button>
      <button class="mode-btn" data-mode="2p">2 PLAYERS</button>
    </div>
    <h2 style="margin:20px 0; font-size:1.8rem">PLAYER 1 - CHOOSE YOUR FIGHTER</h2>
    <div class="char-grid">
      <div class="char-thumb selected" data-char="uemf" style="background-image:url('uemf.png')"></div>
      <div class="char-thumb" data-char="um6p" style="background-image:url('um6p.png')"></div>
      <div class="char-thumb" data-char="uir" style="background-image:url('uir.png')"></div>
    </div>
    <div id="p2-select" style="display:none">
      <h2 style="margin:20px 0; font-size:1.8rem">PLAYER 2 - CHOOSE YOUR FIGHTER</h2>
      <div class="char-grid">
        <div class="char-thumb selected" data-char="um6p" style="background-image:url('um6p.png')"></div>
        <div class="char-thumb" data-char="uemf" style="background-image:url('uemf.png')"></div>
        <div class="char-thumb" data-char="uir" style="background-image:url('uir.png')"></div>
      </div>
    </div>
    <button id="startGameBtn">COMMENCER</button>
  </div>

  <!-- TITRE (disparaît au combat) -->
  <h1 id="title" class="visible">FIGHT AGAINST UNIVERSITIES</h1>

  <!-- HUD -->
  <div class="hud">
    <div class="player-hud" id="p1-hud">
      <div class="name" id="p1-name">UEMF</div>
      <div class="hp-bar"><div class="hp-fill" id="hp1"></div></div>
      <div class="sp-bar"><div class="sp-fill" id="sp1"></div></div>
    </div>
    <div style="background:rgba(0,0,0,0.7);padding:8px 20px;border-radius:12px;font-weight:bold;">FINAL ROUND</div>
    <div class="player-hud" id="p2-hud">
      <div class="name" id="p2-name">UM6P</div>
      <div class="hp-bar"><div class="hp-fill" id="hp2"></div></div>
      <div class="sp-bar"><div class="sp-fill" id="sp2"></div></div>
    </div>
  </div>

  <!-- Personnages -->
  <div id="p1" class="fighter"></div>
  <div id="p2" class="fighter"></div>

  <!-- Victoire -->
  <div id="overlay">
    <h1 id="winner-text">EUROMED WINS!</h1>
    <button id="restartBtn">REPLAY</button>
  </div>

  <div class="controls">
    P1: Left Right Up (A/S/D) | P2: ZQSD (F/G/H)
  </div>
</div>

<!-- Sons -->
<audio id="punch" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-punch-2048.mp3"></audio>
<audio id="hit" src="https://assets.mixkit.co/sfx/preview/mixkit-strong-punch-2045.mp3"></audio>
<audio id="special" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
<audio id="win" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script>
  // === PERSONNAGES ===
  const chars = {
    uemf: { name: "UEMF", fullName: "EUROMED", img: "uemf.png" },
    um6p: { name: "UM6P", fullName: "UM6P", img: "um6p.png" },
    uir:  { name: "UIR",  fullName: "UIR",  img: "uir.png" }
  };

  // === DOM ===
  const splash = document.getElementById('splash');
  const selector = document.getElementById('selector');
  const startSplashBtn = document.getElementById('startSplashBtn');
  const startGameBtn = document.getElementById('startGameBtn');
  const title = document.getElementById('title');
  const game = document.getElementById('game');
  const p1 = document.getElementById('p1');
  const p2 = document.getElementById('p2');
  const hp1 = document.getElementById('hp1');
  const hp2 = document.getElementById('hp2');
  const sp1 = document.getElementById('sp1');
  const sp2 = document.getElementById('sp2');
  const p1Name = document.getElementById('p1-name');
  const p2Name = document.getElementById('p2-name');
  const overlay = document.getElementById('overlay');
  const winnerText = document.getElementById('winner-text');
  const restartBtn = document.getElementById('restartBtn');
  const p2Select = document.getElementById('p2-select');

  const sndPunch = document.getElementById('punch');
  const sndHit = document.getElementById('hit');
  const sndSpecial = document.getElementById('special');
  const sndWin = document.getElementById('win');

  // === ÉTAT ===
  let mode = '1p';
  let p1Char = 'uemf', p2Char = 'um6p';
  const state = {
    running: false,
    p1: { x: 200, hp: 100, sp: 0, dir: 1, jumping: false, blocking: false, attacking: false },
    p2: { x: 880, hp: 100, sp: 0, dir: -1, jumping: false, blocking: false, attacking: false, aiTimer: 0 },
    keys: {}
  };

  // === ÉCRAN D'ACCUEIL → SÉLECTEUR ===
  startSplashBtn.onclick = () => {
    splash.style.display = 'none';
    selector.style.display = 'flex';
  };

  // === SÉLECTEUR DE MODE ===
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      mode = btn.dataset.mode;
      p2Select.style.display = mode === '2p' ? 'block' : 'none';
    });
  });

  // === SÉLECTION DES PERSONNAGES ===
  document.querySelectorAll('.char-thumb').forEach(thumb => {
    thumb.addEventListener('click', () => {
      const parent = thumb.parentElement;
      parent.querySelectorAll('.char-thumb').forEach(t => t.classList.remove('selected'));
      thumb.classList.add('selected');
      if (parent.parentElement.id === 'p2-select') {
        p2Char = thumb.dataset.char;
      } else {
        p1Char = thumb.dataset.char;
      }
    });
  });

  // === CHOIX IA AUTOMATIQUE (DIFFÉRENT DU JOUEUR) ===
  function chooseAICharacter() {
    const available = Object.keys(chars).filter(c => c !== p1Char);
    p2Char = available[Math.floor(Math.random() * available.length)];
  }

  // === DÉMARRER LE COMBAT ===
  startGameBtn.onclick = () => {
    if (mode === '1p') {
      chooseAICharacter(); // IA = PERSONNAGE DIFFÉRENT
    }
    selector.style.display = 'none';
    title.classList.remove('visible');
    resetGame();
    state.running = true;
    requestAnimationFrame(loop);
  };

  restartBtn.onclick = () => location.reload();

  function resetGame() {
    state.p1 = { x: 200, hp: 100, sp: 0, dir: 1, jumping: false, blocking: false, attacking: false };
    state.p2 = { x: 880, hp: 100, sp: 0, dir: -1, jumping: false, blocking: false, attacking: false, aiTimer: 15 + Math.random() * 20 };
    p1Name.textContent = chars[p1Char].name;
    p2Name.textContent = chars[p2Char].name;
    p1.style.backgroundImage = `url('${chars[p1Char].img}')`;
    p2.style.backgroundImage = `url('${chars[p2Char].img}')`;
    p1.style.left = '200px';
    p2.style.left = '880px';
    p1.className = 'fighter'; p2.className = 'fighter';
    updateHUD();
  }

  // === INPUTS ===
  window.addEventListener('keydown', e => {
    if (!state.running) return;
    const k = e.key.toLowerCase();
    state.keys[k] = true;
    if (mode === '2p') {
      if (k === 'z') state.keys['arrowup'] = true;
      if (k === 'q') state.keys['arrowleft'] = true;
      if (k === 'd') state.keys['arrowright'] = true;
      if (k === 'f') state.keys['a'] = true;
      if (k === 'g') state.keys['s'] = true;
      if (k === 'h') state.keys['d'] = true;
    }
  });

  window.addEventListener('keyup', e => {
    const k = e.key.toLowerCase();
    state.keys[k] = false;
    if (mode === '2p') {
      if (k === 'z') state.keys['arrowup'] = false;
      if (k === 'q') state.keys['arrowleft'] = false;
      if (k === 'd') state.keys['arrowright'] = false;
      if (k === 'f') state.keys['a'] = false;
      if (k === 'g') state.keys['s'] = false;
      if (k === 'h') state.keys['d'] = false;
    }
  });

  // === BOUCLE DE JEU ===
  function loop() {
    if (!state.running) return;
    handlePlayer('p1');
    if (mode === '1p') handleAggressiveAI();
    else handlePlayer('p2');
    updatePositions();
    updateHUD();
    checkWin();
    requestAnimationFrame(loop);
  }

  function handlePlayer(player) {
    const s = player === 'p1' ? state.p1 : state.p2;
    const keys = { left: 'arrowleft', right: 'arrowright', up: 'arrowup', a: 'a', s: 's', d: 'd' };
    if (player === 'p2') {
      keys.left = 'q'; keys.right = 'd'; keys.up = 'z'; keys.a = 'f'; keys.s = 'g'; keys.d = 'h';
    }
    const speed = 9;
    if (state.keys[keys.left] && s.x > 50) s.x -= speed;
    if (state.keys[keys.right] && s.x < 1050) s.x += speed;
    if (state.keys[keys.up] && !s.jumping) {
      s.jumping = true;
      (player === 'p1' ? p1 : p2).classList.add('jumping');
      setTimeout(() => { s.jumping = false; (player === 'p1' ? p1 : p2).classList.remove('jumping'); }, 650);
    }
    s.dir = (player === 'p1' ? state.p2.x > s.x : state.p1.x > s.x) ? 1 : -1;
    (player === 'p1' ? p1 : p2).style.setProperty('--dir', s.dir);
    if (state.keys[keys.a] && !s.attacking) attack(player, 10, 16, 18);
    if (state.keys[keys.s] && !s.attacking) attack(player, 16, 24, 30);
    if (state.keys[keys.d] && s.sp >= 100) special(player);
  }

  function handleAggressiveAI() {
    const p = state.p2;
    const target = state.p1;
    p.aiTimer--;
    if (p.aiTimer > 0) return;
    p.aiTimer = 15 + Math.random() * 20;

    const dist = Math.abs(p.x - target.x);
    if (dist > 180) p.x += target.x > p.x ? -12 : 12;
    else if (dist < 120) p.x += target.x > p.x ? 10 : -10;

    const r = Math.random();
    if (dist < 170) {
      if (r < 0.5) attack('p2', 14, 22, 25);
      else if (r < 0.75) attack('p2', 20, 30, 35);
      else if (p.sp >= 100) special('p2');
      else if (r < 0.9) { p.blocking = true; setTimeout(() => p.blocking = false, 500); }
      else { p.jumping = true; p2.classList.add('jumping'); setTimeout(() => { p.jumping = false; p2.classList.remove('jumping'); }, 650); }
    }
  }

  function attack(player, minDmg, maxDmg, spGain) {
    const p = player === 'p1' ? state.p1 : state.p2;
    const el = player === 'p1' ? p1 : p2;
    if (p.attacking) return;
    p.attacking = true;
    el.classList.add('attacking');
    sndPunch.currentTime = 0; sndPunch.play();

    setTimeout(() => {
      const target = player === 'p1' ? state.p2 : state.p1;
      if (Math.abs(p.x - target.x) < 160 && !target.blocking) {
        const dmg = Math.floor(Math.random() * (maxDmg - minDmg + 1)) + minDmg;
        target.hp = Math.max(0, target.hp - dmg);
        p.sp = Math.min(100, p.sp + spGain);
        hitEffect(target.x + 70, 300);
        screenShake(7);
        (player === 'p1' ? p2 : p1).classList.add('hurt');
        setTimeout(() => (player === 'p1' ? p2 : p1).classList.remove('hurt'), 200);
      }
      el.classList.remove('attacking');
      p.attacking = false;
    }, 220);
  }

  function special(player) {
    const p = player === 'p1' ? state.p1 : state.p2;
    p.sp = 0;
    const el = player === 'p1' ? p1 : p2;
    el.style.filter = 'brightness(2) drop-shadow(0 0 25px gold)';
    sndSpecial.currentTime = 0; sndSpecial.play();

    setTimeout(() => {
      const target = player === 'p1' ? state.p2 : state.p1;
      if (Math.abs(p.x - target.x) < 350) {
        target.hp = Math.max(0, target.hp - 50);
        for (let i = 0; i < 30; i++) {
          setTimeout(() => hitEffect(target.x + 70 + Math.random()*140-70, 260 + Math.random()*60), i*35);
        }
        screenShake(16);
      }
      el.style.filter = '';
    }, 450);
  }

  function checkWin() {
    if (state.p1.hp <= 0 || state.p2.hp <= 0) {
      state.running = false;
      sndWin.currentTime = 0; sndWin.play();
      const winnerChar = state.p1.hp > 0 ? p1Char : p2Char;
      const winnerName = chars[winnerChar].fullName;
      winnerText.textContent = `${winnerName} WINS!`;
      setTimeout(() => overlay.style.display = 'flex', 800);
    }
  }

  function updatePositions() {
    p1.style.left = state.p1.x + 'px';
    p2.style.left = state.p2.x + 'px';
  }

  function updateHUD() {
    hp1.style.width = state.p1.hp + '%';
    hp2.style.width = state.p2.hp + '%';
    sp1.style.width = state.p1.sp + '%';
    sp2.style.width = state.p2.sp + '%';
    if (state.p1.sp < 100) state.p1.sp = Math.min(100, state.p1.sp + 0.4);
    if (state.p2.sp < 100) state.p2.sp = Math.min(100, state.p2.sp + 0.45);
  }

  function hitEffect(x, y) {
    for (let i = 0; i < 12; i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      p.style.setProperty('--dx', (Math.random() - 0.5) * 140 + 'px');
      p.style.setProperty('--dy', (Math.random() - 0.5) * 140 + 'px');
      p.style.background = Math.random() > 0.5 ? '#ff6b6b' : '#08f7fe';
      game.appendChild(p);
      setTimeout(() => p.remove(), 600);
    }
    sndHit.currentTime = 0; sndHit.play();
  }

  function screenShake(intensity) {
    game.classList.add('screen-shake');
    for (let i = 0; i < 12; i++) {
      setTimeout(() => {
        game.style.setProperty('--sx', (Math.random() - 0.5) * intensity + 'px');
        game.style.setProperty('--sy', (Math.random() - 0.5) * intensity + 'px');
      }, i * 35);
    }
    setTimeout(() => game.classList.remove('screen-shake'), 420);
  }
</script>
</body>
</html>